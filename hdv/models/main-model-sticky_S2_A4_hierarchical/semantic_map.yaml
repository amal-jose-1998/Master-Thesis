label_rules:
  unknown_z: -1
  A: 4

  thresholds:
    lc_flag_thresh: 0.5

    brake_ax_neg_frac: 0.90
    brake_ax_last: -0.15

    tactical_brake_ax_last: -0.25
    tactical_brake_vx_slope: -0.01
    tactical_brake_thw: 2.2
    tactical_brake_ttc: 80.0

    strong_acc_ax_pos_frac: 0.90
    strong_acc_ax_last: 0.15

    constrained_acc_ax_pos_frac: 0.65
    constrained_acc_ax_last: 0.05
    constrained_acc_front_exists: 0.80

    free_flow_front_exists_max: 0.60

    constrained_follow_front_exists: 0.80
    constrained_follow_vx_last_max: 21.0
    constrained_follow_jerk_min: 0.20

    stable_follow_front_exists: 0.80
    stable_follow_vx_slope_abs_max: 0.007
    stable_follow_ax_last_abs_max: 0.15

  persistence:
    min_run: 2
    short_run_to_unknown: true
  
  priority:
    - s1_a1_lane_change
    - brake_then_split_tactical_vs_mild
    - s1_a0_strong_acc
    - s0_a2_constrained_acc
    - s1_a2_constrained_follow
    - s0_a3_stable_follow
    - s0_a0_free_flow
    - unknown

  tactical_brake_definition:
    any_of:
      - "ax_last <= tactical_brake_ax_last"
      - "vx_slope <= tactical_brake_vx_slope"
      - "front_thw_last <= tactical_brake_thw (if feature exists)"
      - "front_ttc_min <= tactical_brake_ttc (if feature exists)"

styles:
  s0:
    name: free_flow_low_interaction
    description: Low interaction regime; motion primarily unconstrained by leading vehicles or dense traffic.
  s1:
    name: tactical_high_interaction
    description: High interaction regime; decisions coupled to surrounding vehicles, gaps, and tactical constraints.

actions_by_style:
  s0:
    a0:
      name: free_flow_speed_modulation
      description: High-speed free-flow with little to no leader influence; frequent small accel/decel adjustments rather than steady cruising.
      condition:
        all_of:
          - "front_exists_frac < free_flow_front_exists_max"
          # a0 is reached after stable_follow check, so no extra constraints are needed here.
    a1:
      name: sustained_braking_following
      description: Sustained deceleration while following (interaction-driven braking).
      condition:
          all_of:
            - "ax_neg_frac >= brake_ax_neg_frac"
            - "ax_last <= brake_ax_last"
            - "front_exists_frac >= stable_follow_front_exists"
            - "NOT tactical_brake"
    a2:
      name: constrained_acceleration
      description: Acceleration episodes but constrained by context (not pure free acceleration).
      condition:
        all_of:
          - "ax_pos_frac >= constrained_acc_ax_pos_frac"
          - "ax_last >= constrained_acc_ax_last"
          - "front_exists_frac >= constrained_acc_front_exists"
    a3:
      name: stable_following_with_micro_adjustments
      description: Stable car-following with mild control and limited speed change.
      condition:
        all_of:
          - "front_exists_frac >= stable_follow_front_exists"
          - "abs(vx_slope) <= stable_follow_vx_slope_abs_max"
          - "abs(ax_last) <= stable_follow_ax_last_abs_max"
  s1:
    a0:
      name: tactical_acceleration
      description: Acceleration-dominant behavior in the tactical regime; leader often present but interaction risk is low (very large TTC, non-critical gaps).
      condition:
        all_of:
          - "ax_pos_frac >= strong_acc_ax_pos_frac"
          - "ax_last >= strong_acc_ax_last"
    a1:
      name: lane_change_speed_adjustments
      description: Lane change maneuver with associated speed adjustments.
      condition:
          any_of:
            - "lc_left_present > lc_flag_thresh"
            - "lc_right_present > lc_flag_thresh"
    a2:
      name: constrained_following
      description: Constrained following with frequent speed corrections (often low-speed / stop-and-go effects), not purely steady.
      condition:
        all_of:
          - "front_exists_frac >= constrained_follow_front_exists"
          - "vx_last <= constrained_follow_vx_last_max"
          - "jerk_x_p95 >= constrained_follow_jerk_min"
    a3:
      name: car_following_sustained_braking
      description: Car-following with sustained braking in high-interaction context.
      condition:
          all_of:
            - "ax_neg_frac >= brake_ax_neg_frac"
            - "ax_last <= brake_ax_last"
            - "front_exists_frac >= stable_follow_front_exists"
            - "tactical_brake"

other_cases:
  fallback_leader_to_s0_a3:
    description: If a leader exists but no rule matched, default to stable-following semantics.
    condition:
      all_of:
        - "front_exists_frac > 0.0"
        - "no_other_condition_matched"

  unknown:
    description: No lane-change, no braking, no acceleration, no following pattern detected.
    condition:
      - "no_other_condition_matched"