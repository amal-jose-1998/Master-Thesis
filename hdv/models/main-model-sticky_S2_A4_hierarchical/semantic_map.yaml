label_rules:
  unknown_z: -1
  A: 4

  thresholds:
    # Lane change
    lc_flag_thresh: 0.5
    lateral_velocity_threshold: 0.1 # to confirm actual lateral movement
    lateral_acceleration_threshold: 0.1 # to confirm active lane change rather than just a small lateral drift
    lateral_velocity_slope_threshold: 0.003 # to confirm sustained lateral movement consistent with a lane change
    ay_zero_frac_threshold: 0.5 # at least 50% of the lane change window should have near-zero lateral acceleration, indicating a steady lane change rather than a quick swerve

    # Sustained braking
    brake_ax_neg_frac: 0.90 # almost the whole window is braking
    brake_ax_last: -0.15 # it sits between the mild braking mean (−0.154) and strong braking mean (−0.321), and safely away from near-zero following

    # Split: tactical braking (s1/a3) vs mild braking (s0/a1)
    tactical_brake_ax_last: -0.25 # Directly separating the two braking means
    tactical_brake_vx_slope: -0.01 # sits between them and is within the global negative tail (p10 = −0.0137).
    tactical_brake_thw: 2.0 # below it looks like the tighter tactical braking.
    tactical_brake_ttc: 70.0

    # Interaction tightness (used beyond braking)
    interaction_thw_tight: 2.0
    interaction_ttc_tight: 60.0

    # Strong accel (s1/a0)
    strong_acc_front_exists_min: 0.50
    strong_acc_ax_pos_frac: 0.90 # isolates “accel-dominant window”
    strong_acc_ax_last: 0.15 # clearly positive acceleration but not too extreme.

    # Constrained accel (s0/a2)
    constrained_acc_ax_pos_frac: 0.65 # above typical but not extreme tail.
    constrained_acc_ax_last: 0.08 # positive enough to be accelerating
    constrained_acc_front_exists: 0.80 # a strong “leader present” gate.

    # Free-flow modulation (s0/a0)
    free_flow_front_exists_max: 0.50 # <0.50 => low interaction.

    # Constrained following (s1/a2)
    constrained_follow_front_exists: 0.80 # a strong “leader present” gate.
    constrained_follow_vx_last_max: 21.0 # low speed
    constrained_follow_jerk_min: 0.75 # pushes into the tail 

    stable_follow_front_exists: 0.80 # a strong “leader present” gate.
    stable_follow_vx_slope_abs_max: 0.008 # approximately 2× the within-state std
    stable_follow_ax_last_abs_max: 0.20 # approximately 1× the within-state std (since ax_last is noisier and overlaps more across states than vx_slope)
  
  priority:
    - s1_a1_lane_change
    - brake_then_split_tactical_vs_mild
    - s1_a0_strong_acc
    - s0_a2_constrained_acc
    - s1_a2_constrained_follow
    - s0_a3_stable_follow
    - s0_a0_free_flow
    - unknown

  tactical_brake_definition:
    any_of:
      - "ax_last <= tactical_brake_ax_last"
      - "vx_slope <= tactical_brake_vx_slope"
      - "front_thw_last <= tactical_brake_thw (if feature exists)"
      - "front_ttc_min <= tactical_brake_ttc (if feature exists)"

  tight_interaction_definition:
    all_of:
      - "front_exists_frac >= stable_follow_front_exists"
      - any_of:
        - "front_thw_last <= interaction_thw_tight (if feature exists)"
        - "front_ttc_min <= interaction_ttc_tight (if feature exists)"

styles:
  s0:
    name: low_interaction
    description: Low interaction regime; motion primarily unconstrained by leading vehicles or dense traffic (non-tactical / smooth control).
  s1:
    name: high_interaction
    description: High interaction regime; decisions coupled to surrounding vehicles, gaps, and tactical constraints.

actions_by_style:
  s0:
    a0:
      name: free_flow
      description: High-speed free-flow with little to no leader influence; frequent small accel/decel adjustments rather than steady cruising.
      condition:
        all_of:
          - "front_exists_frac < free_flow_front_exists_max"
          # a0 is reached after stable_follow check, so no extra constraints are needed here.
    a1:
      name: mild_brake
      description: Sustained deceleration while following (interaction-driven braking).
      condition:
          all_of:
            - "ax_neg_frac >= brake_ax_neg_frac"
            - "ax_last <= brake_ax_last"
            - "front_exists_frac >= stable_follow_front_exists"
            - "NOT tactical_brake"
    a2:
      name: constrained_acceleration
      description: Acceleration episodes but constrained by context (not pure free acceleration).
      condition:
        all_of:
          - "ax_pos_frac >= constrained_acc_ax_pos_frac"
          - "ax_last >= constrained_acc_ax_last"
          - "front_exists_frac >= constrained_acc_front_exists"
    a3:
      name: stable_following
      description: Stable car-following with mild control and limited speed change.
      condition:
        all_of:
          - "front_exists_frac >= stable_follow_front_exists"
          - "abs(vx_slope) <= stable_follow_vx_slope_abs_max"
          - "abs(ax_last) <= stable_follow_ax_last_abs_max"
          - "NOT tight_interaction"
  s1:
    a0:
      name: strong_acceleration
      description: Acceleration-dominant behavior in the tactical regime; leader often present but interaction risk is low (very large TTC, non-critical gaps).
      condition:
        all_of:
          - "ax_pos_frac >= strong_acc_ax_pos_frac"
          - "ax_last >= strong_acc_ax_last"
          - any_of:
            - "front_exists_frac >= strong_acc_front_exists_min"
            - "tight_interaction"
    a1:
      name: lane_change
      description: Lane change maneuver with associated speed adjustments.
      condition:
          any_of:
            - "lc_left_present > lc_flag_thresh"
            - "lc_right_present > lc_flag_thresh"
            - all_of:
              - "lateral_velocity >= lateral_velocity_threshold"
              - "lateral_acceleration >= lateral_acceleration_threshold"
              - "lateral_velocity_slope >= lateral_velocity_slope_threshold"
              - "ay_zero_frac >= ay_zero_frac_threshold"
    a2:
      name: constrained_following
      description: Constrained following with frequent speed corrections (often low-speed / stop-and-go effects), not purely steady.
      condition:
        all_of:
          - "front_exists_frac >= constrained_follow_front_exists"
          - any_of:
            - all_of: 
              - "vx_last <= constrained_follow_vx_last_max" 
              - "jerk_x_p95 >= constrained_follow_jerk_min"
            - "tight_interaction"
    a3:
      name: tactical_brake
      description: Car-following with sustained braking in high-interaction context.
      condition:
          all_of:
            - "ax_neg_frac >= brake_ax_neg_frac"
            - "ax_last <= brake_ax_last"
            - "front_exists_frac >= stable_follow_front_exists"
            - "tactical_brake"

other_cases:
  unknown:
    description: No lane-change, no braking, no acceleration, no following pattern detected.
    condition:
      - "no_other_condition_matched"